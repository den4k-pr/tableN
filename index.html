<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/nullStyle.css">
    <link rel="icon" href="./img/favicon.png" type="image/png">
    <link rel="stylesheet" href="css/main.css">
    <title>Ho-ho-hold That Stretch!</title>

</head>

<body>

    <img src="./img/plants.png" class="plants" alt="plants">
    <div style="padding: 0 10px;">
        <h1 class="title">
            Ho-ho-hold<br><span style="color: red">That Stretch!</span>
        </h1>
        <p class="mainText">
            When everything gets festive and busy, your body<br>deserves softness and attention<br><br>

            Inside this calendar youâ€™ll find small daily pleasures:<br><span class="red-text">short flows, gentle
                mobility, self-care rituals,
                and<br>simple practices</span> that help you end the year feeling<br>lighter, stronger, and proud of
            yourself<br><br>

            <span style="font-weight: 600;">A gift from you, to you ðŸ’›</span>
        </p>
    </div>
    <img src="./img/kris.png" class="kris" alt="kris">
    <img src="./img/logo.svg" class="logo" alt="logo">
    <div class="popup">
        <div class="popup__content">
            <button class="close"><img src="./img/close.svg" alt="close"></button>
            <h2 class="popup__content-title">
                Lets<br>start<br>with <br>day <span>1</span>!</h2>

            <p class="popup__content-text">
                Before we jump into the fun, letâ€™s set the foundationâœ¨<br> Use it daily to keep your routines simple,
                joyful, and stress-free
            </p>
            <button class="download">
                Download a Tracker
                <img src="./img/file.png" class="img-file" alt="file">
            </button>
        </div>
    </div>
    <div class="calendar-grid">
        <div class="item g m">01</div>
        <div class="item r w-2">02</div>
        <div class="item b m">03</div>

        <div class="item r h-2">04</div>
        <div class="item b m">05</div>
        <div class="item r w-2">06</div>

        <div class="item g m">07</div>
        <div class="item r m">08</div>
        <div class="item b h-2">09</div>
        <div class="item b m">10</div>
        <div class="item g w-2">11</div>

        <div class="item r m">12</div>
        <div class="item b m">13</div>
        <div class="item r m">14</div>
        <div class="item g m">15</div>

        <div class="item g w-2">16</div>
        <div class="item b h-2">17</div>
        <div class="item r h-2">18</div>

        <div class="item r h-2">20</div>
        <div class="item g m">19</div>

        <div class="item b m">21</div>
        <div class="item r m">22</div>
        <div class="item g m">23</div>

        <div class="item g w-2" style="z-index: 3;">24</div>
        <div class="item r w-2" style="z-index: 2;"><img src="./img/dm.svg" class="dm" alt="dm" />25</div>

        <div class="item r m">26</div>
        <div class="item b w-2">27</div>

        <div class="item h-2">30</div>

        <div class="item w-2">28</div>
        <div class="item m">29</div>
    </div>


</body>
<script>
   document.addEventListener("DOMContentLoaded", () => {

    const popup = document.querySelector(".popup");
    const popupContent = document.querySelector(".popup__content");
    const btnClose = document.querySelector(".popup .close");
    const btnDownload = document.querySelector(".popup .download");
    const popupDaySpan = document.querySelector(".popup__content-title span");
    const items = document.querySelectorAll(".calendar-grid .item");

    if (!popup) return;

    // ============================================================
    //                    STORAGE DATA
    // ============================================================

    let openedDays = JSON.parse(localStorage.getItem("openedDays")) || [];
    let dailyOpened = JSON.parse(localStorage.getItem("dailyOpened")) || [];
    let limitTimestamp = localStorage.getItem("limitTimestamp");

    // ============================================================
    //                 DAILY RESET LOGIC
    // ============================================================

    function checkDailyReset() {
        if (!limitTimestamp) return;

        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000;

        if (now - limitTimestamp >= oneDay) {
            dailyOpened = [];
            localStorage.setItem("dailyOpened", JSON.stringify([]));
            limitTimestamp = Date.now();
            localStorage.setItem("limitTimestamp", limitTimestamp);
        }
    }
    checkDailyReset();

    // ============================================================
    //             APPLY VISUAL STATE BASED ON OPENED DAYS
    // ============================================================

    items.forEach(item => {
        const day = parseInt(item.textContent.replace(/\D/g, ""), 10);
        if (openedDays.includes(day)) {
            item.style.opacity = "1";
        } else {
            item.style.opacity = "0.5";
        }
    });

    // ============================================================
    //                     INTRO ANIMATION
    // ============================================================

    let animationStopped = false;

    function runButtonIntroAnimation() {
        const buttons = Array.from(items);
        let index = 0;

        function animateNext() {
            if (animationStopped) return;

            const btn = buttons[index];
            btn.style.transition = "transform 0.25s ease";
            btn.style.transform = "scale(1.02)";

            setTimeout(() => {
                btn.style.transform = "scale(1)";

                setTimeout(() => {
                    index++;
                    if (index >= buttons.length) index = 0;
                    animateNext();
                }, 120);

            }, 250);
        }

        animateNext();
    }

    runButtonIntroAnimation();

    items.forEach(btn => {
        btn.addEventListener("click", () => {
            animationStopped = true;
        }, { once: true });
    });


    // ============================================================
    //                           POPUP
    // ============================================================

    function openPopup(dayNumber) {
        popupDaySpan.textContent = dayNumber;
        popup.classList.add("active");
    }

    function closePopup() {
        popup.classList.remove("active");
    }

    // ============================================================
    //                         CLICK LOGIC
    // ============================================================

    items.forEach(item => {
        item.addEventListener("click", () => {

            const day = parseInt(item.textContent.replace(/\D/g, ""), 10);

            const alreadyOpened = openedDays.includes(day);

            if (!alreadyOpened) {

                // Start new day window
                if (dailyOpened.length === 0) {
                    limitTimestamp = Date.now();
                    localStorage.setItem("limitTimestamp", limitTimestamp);
                }

                // Check daily limit
                if (dailyOpened.length >= 2) {
                    alert("You can open only 2 items per 24 hours!");
                    return;
                }

                // Mark this as opened forever
                openedDays.push(day);
                localStorage.setItem("openedDays", JSON.stringify(openedDays));

                // Mark this as opened for today
                dailyOpened.push(day);
                localStorage.setItem("dailyOpened", JSON.stringify(dailyOpened));

                item.style.opacity = "1";
            }

            openPopup(day);
        });
    });

    // ============================================================
    //                      POPUP CLOSE LOGIC
    // ============================================================

    btnClose?.addEventListener("click", closePopup);

    popup.addEventListener("click", (e) => {
        if (!popupContent.contains(e.target)) closePopup();
    });

    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closePopup();
    });

    // ============================================================
    //                        DOWNLOAD PDF
    // ============================================================

    btnDownload?.addEventListener("click", () => {
        const link = document.createElement("a");
        link.href = "./tracker.pdf";
        link.download = "tracker.pdf";
        document.body.appendChild(link);
        link.click();
        link.remove();
    });

});

</script>



</html>